<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Snakes and Ladders Game</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Icon -->
    <link rel="icon" type="image/x-icon" href="images/icon.png" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <script
      defer
      src="https://unpkg.com/mathlive@0.98.5/dist/mathlive.min.js"
    ></script>
    <style>
      /* MathLive Keyboard Z-Index Fix */
      :root {
        --keyboard-zindex: 20000; /* Angka sangat besar agar di atas modal */
      }

      /* Pastikan elemen keyboard bisa menerima klik */
      div.ML__keyboard,
      .ML__virtual-keyboard-container {
        pointer-events: all !important;
        z-index: 20000 !important;
      }

      /* Hilangkan hambatan pointer pada math-field */
      math-field {
        pointer-events: all !important;
        touch-action: manipulation;
      }

      /* Warna saat dipilih */
      #diff-easy.selected {
        background-color: #2ecc71 !important;
        color: white;
        border-color: #27ae60;
      }

      #diff-standard.selected {
        background-color: #f1c40f !important;
        color: white;
        border-color: #f39c12;
      }

      #diff-hard.selected {
        background-color: #e67e22 !important;
        color: white;
        border-color: #d35400;
      }

      .difficultyBox:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .tile-easy {
        background-color: rgba(46, 204, 113, 0.4) !important;
      } /* Hijau */
      .tile-standard {
        background-color: rgba(241, 196, 15, 0.4) !important;
      } /* Kuning */
      .tile-hard {
        background-color: rgba(231, 76, 60, 0.4) !important;
      } /* Merah */
      .tile-mystery {
        background-color: rgba(155, 89, 182, 0.4) !important;
      } /* Ungu */

      .storm-ui-box {
        position: absolute;
        top: 20px;
        left: 20px; /* Di sisi kiri atas, berlawanan dengan info-btn */
        background: rgba(44, 62, 80, 0.9);
        padding: 12px;
        border-radius: 12px;
        color: white;
        min-width: 150px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        border: 2px solid #9b59b6;
        z-index: 100;
        font-family: sans-serif;
      }

      .storm-header {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #e0aaff;
        margin-bottom: 5px;
      }

      .storm-time {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        font-family: "Courier New", Courier, monospace;
        color: #fff;
        text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
      }

      .storm-bar-bg {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        margin-top: 8px;
        overflow: hidden;
      }

      .storm-bar-fill {
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, #9b59b6, #8e44ad);
        transition: width 1s linear;
      }

      /* Animasi saat badai hampir tiba */
      .storm-warning {
        animation: flash-red 1s infinite alternate;
      }

      @keyframes flash-red {
        from {
          border-color: #9b59b6;
          box-shadow: 0 0 5px #9b59b6;
        }
        to {
          border-color: #e74c3c;
          box-shadow: 0 0 20px #e74c3c;
        }
      }

      /* Gaya Tombol Musik Global - Digeser ke kiri sedikit */
      .music-btn-global {
        position: fixed;
        top: 20px;
        right: 80px; /* Diubah dari 20px ke 80px agar memberi ruang untuk tombol Info */
        z-index: 9999;
        background: rgba(44, 62, 80, 0.8);
        border: 2px solid #2ecc71;
        color: white;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .music-btn-global:hover {
        transform: scale(1.1);
      }

      /* Responsif untuk layar kecil */
      @media screen and (max-width: 768px) {
        .music-btn-global {
          width: 40px;
          height: 40px;
          top: 15px;
          right: 70px; /* Penyesuaian jarak di HP */
        }
      }
    </style>
  </head>
  <body>
    <button
      id="musicToggleGlobal"
      class="ui-round-btn music-btn-global"
      onclick="toggleMusic()"
      title="Musik"
    >
      <span class="material-symbols-outlined" id="musicIcon">music_off</span>
    </button>
    <div class="screen" id="screen1">
      <div class="s1-card">
        <h1>Ular Tangga Matematika</h1>
        <p class="subHeading">Uji Keberuntunganmu, Taklukkan Setiap Peluang!</p>

        <div class="choose">
          <div class="selectBox selected" onclick="selectPlayers(2)">
            <span>2</span> <span>Pemain</span>
          </div>
          <div class="selectBox" onclick="selectPlayers(3)">
            <span>3</span> <span>Pemain</span>
          </div>
          <div class="selectBox" onclick="selectPlayers(4)">
            <span>4</span> <span>Pemain</span>
          </div>
        </div>

        <button class="startBtn" onclick="start()">LANJUT</button>
        <button
          class="startBtn"
          onclick="openGuideModal()"
          style="background: #34495e; margin-top: 10px"
        >
          CARA BERMAIN
        </button>
      </div>
    </div>
    <div class="screen" id="screen2">
      <div class="s1-card">
        <h1>Profile & Tingkat Kesulitan</h1>

        <div class="cards">
          <div class="card" id="card1">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(1,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/1.png" id="profile1" />
              </div>
              <div class="arrow" onclick="updateUserProfile(1,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(1)"
                onblur="updateValue(1)"
                type="text"
                placeholder="Nami..."
                value="Player1"
                id="name1"
              />
            </div>
          </div>

          <div class="card" id="card2">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(2,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/0.png" id="profile2" />
              </div>
              <div class="arrow" onclick="updateUserProfile(2,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(2)"
                onblur="updateValue(2)"
                type="text"
                placeholder="Nami..."
                value="Player2"
                id="name2"
              />
            </div>
          </div>

          <div class="card" id="card3">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(3,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/3.png" id="profile3" />
              </div>
              <div class="arrow" onclick="updateUserProfile(3,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(3)"
                onblur="updateValue(3)"
                type="text"
                placeholder="Nami..."
                value="Player3"
                id="name3"
              />
            </div>
          </div>

          <div class="card" id="card4">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(4,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/4.png" id="profile4" />
              </div>
              <div class="arrow" onclick="updateUserProfile(4,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(4)"
                onblur="updateValue(4)"
                type="text"
                placeholder="Nami..."
                value="Player4"
                id="name4"
              />
            </div>
          </div>
        </div>

        <hr style="width: 80%; margin: 20px auto; opacity: 0.3" />

        <div class="difficulty-selection">
          <h3 style="margin-bottom: 15px; font-family: sans-serif">
            Pilih Tingkat Kesulitan Game:
          </h3>
          <div class="choose" style="justify-content: center; gap: 15px">
            <div
              class="selectBox difficultyBox"
              id="diff-easy"
              onclick="setGameDifficulty('easy')"
            >
              <span>Mudah</span>
            </div>

            <div
              class="selectBox difficultyBox selected"
              id="diff-standard"
              onclick="setGameDifficulty('standard')"
            >
              <span>Standar</span>
            </div>

            <div
              class="selectBox difficultyBox"
              id="diff-hard"
              onclick="setGameDifficulty('hard')"
            >
              <span>Sulit</span>
            </div>
          </div>
        </div>

        <div style="margin-top: 30px">
          <button class="startBtn" onclick="back()">Kembali</button>
          <button class="startBtn next" onclick="next()">MULAI GAME</button>
        </div>
      </div>
    </div>
    <div class="screen" id="screen3">
      <!-- Game board player status and many more -->
      <div class="container">
        <button class="info-btn" onclick="openInfoModal()">
          <span class="material-symbols-outlined">info</span>
        </button>
        <div id="stormTimerContainer" class="storm-ui-box">
          <div class="storm-header">
            <i class="fas fa-bolt"></i>
            <span>Probability Storm</span>
          </div>
          <div id="stormCountdown" class="storm-time">04:00</div>
          <div class="storm-bar-bg">
            <div id="stormProgressBar" class="storm-bar-fill"></div>
          </div>
        </div>
        <div class="boardArea">
          <div class="bigBoard">
            <img src="images/board.jpeg" class="board" />
            <div class="potsBoard" id="board"></div>
          </div>
        </div>
        <div class="gamePlayers">
          <div class="playersBox">
            <div class="playerCard" id="playerCard1">
              <div class="level1">
                <img src="images/avatars/1.png" id="avatar1" />
                <div id="dice1" class="diceBox" onclick="rollDice(1)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName1">Player1</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard2">
              <div class="level1">
                <img src="images/avatars/2.png" id="avatar2" />
                <div id="dice2" class="diceBox" onclick="rollDice(2)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName2">Player2</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard4">
              <div class="level1">
                <img src="images/avatars/4.png" id="avatar4" />
                <div id="dice4" class="diceBox" onclick="rollDice(4)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName4">Player4</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard3">
              <div class="level1">
                <img src="images/avatars/3.png" id="avatar3" />
                <div id="dice3" class="diceBox" onclick="rollDice(3)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName3">Player3</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal hide" id="modal">
      <div class="modalBody">
        <img src="images/avatars/0.png" id="wimg" />
        <h1>Winner is <span id="wname"></span></h1>
        <button class="startBtn" onclick="window.location.reload()">
          New Game
        </button>
      </div>
    </div>
    <audio src="audio/drop.mp3" id="drop" style="display: none"></audio>
    <audio src="audio/ladder.mp3" id="ladder" style="display: none"></audio>
    <audio src="audio/snake.mp3" id="snake" style="display: none"></audio>
    <audio src="audio/dice.mp3" id="diceAudio" style="display: none"></audio>
    <audio src="audio/success.mp3" id="success" style="display: none"></audio>
    <audio id="bgmAudio" loop>
      <source src="audio/BGM.mp3" type="audio/mpeg" />
    </audio>

    <div class="modal hide" id="guideModal">
      <div
        class="modalBody"
        style="max-width: 650px; text-align: left; padding: 0"
      >
        <div style="padding: 25px; border-bottom: 2px solid #eee">
          <h1 style="margin: 0; color: #2c3e50; text-align: center">
            Panduan Bermain üìú
          </h1>
        </div>

        <div
          style="
            max-height: 450px;
            overflow-y: auto;
            padding: 25px;
            line-height: 1.6;
            color: #444;
          "
        >
          <h3>1. Tujuan Permainan</h3>
          <p>
            Menjadi pemain pertama yang mencapai kotak nomor 100. Namun, ini
            bukan sekadar keberuntungan dadu, kamu harus menjawab tantangan
            matematika untuk bergerak!
          </p>

          <h3>2. Cara Melangkah</h3>
          <ul>
            <li>Klik dadu pada giliranmu.</li>
            <li>
              Sistem akan memberikan soal matematika sesuai dengan jenis kotak
              yang kamu injak.
            </li>
            <li>
              <strong>Jika Jawaban Benar:</strong> Kamu akan maju 1 langkah
              (atau 3 langkah di kotak Misteri).
            </li>
            <li>
              <strong>Jika Jawaban Salah:</strong> Kamu tetap di tempat (atau
              mundur 1 langkah di kotak Misteri).
            </li>
          </ul>

          <h3>3. Jenis-Jenis Kotak</h3>
          <p>
            Setiap warna kotak memiliki tingkat kesulitan soal yang berbeda:
          </p>
          <ul>
            <li>
              <strong style="color: #27ae60">Kotak Hijau:</strong> Soal Mudah
              (Peluang dasar).
            </li>
            <li>
              <strong style="color: #f1c40f">Kotak Kuning:</strong> Soal Standar
              (Menengah).
            </li>
            <li>
              <strong style="color: #e67e22">Kotak Merah:</strong> Soal Sulit
              (Analisis mendalam).
            </li>
            <li>
              <strong style="color: #9b59b6">Kotak Ungu (Misteri):</strong> Soal
              tantangan dengan hadiah maju 3 langkah atau hukuman mundur 1
              langkah.
            </li>
          </ul>

          <h3>4. Ular & Tangga (Guardian Gate)</h3>
          <p>
            Jika kamu mendarat di tangga atau ular yang berada di
            <strong>kotak berwarna</strong>, kamu harus menjawab soal tambahan
            sebagai penentu nasib:
          </p>
          <ul>
            <li>
              <strong>Berhasil Jawab:</strong> Naik tangga atau Selamat dari
              ular.
            </li>
            <li>
              <strong>Gagal Jawab:</strong> Gagal naik tangga atau Tergelincir
              turun melalui ular.
            </li>
          </ul>

          <h3>5. Probability Storm (Badai Probabilitas)</h3>
          <p>
            Setiap 3 menit, badai akan muncul secara otomatis. Semua pemain akan
            diberikan soal yang sama secara bergantian. Pemain pertama yang
            menjawab benar akan mendapatkan <strong>Bonus 3 Langkah</strong> dan
            badai berakhir.
          </p>

          <h3>6. Statistik & Sertifikat</h3>
          <p>
            Di akhir permainan, pemenang akan mendapatkan sertifikat resmi
            lengkap dengan statistik permainan dan gelar kehormatan berdasarkan
            performa menjawab soal.
          </p>
        </div>

        <div
          style="padding: 20px; text-align: center; border-top: 2px solid #eee"
        >
          <button
            class="startBtn"
            onclick="closeGuideModal()"
            style="width: 100%"
          >
            SAYA MENGERTI
          </button>
        </div>
      </div>
    </div>

    <div class="modal hide" id="certificateModal">
      <div
        class="modalBody"
        style="
          max-width: 600px;
          padding: 0;
          background: transparent;
          border: none;
        "
      >
        <div
          id="certificateExportArea"
          style="
            background: white;
            padding: 40px;
            border: 15px double #d4af37;
            text-align: center;
            font-family: 'Georgia', serif;
            position: relative;
          "
        >
          <div style="font-size: 60px; color: #d4af37; margin-bottom: 10px">
            üèÖ
          </div>
          <h1
            style="
              margin: 0;
              color: #2c3e50;
              letter-spacing: 3px;
              font-size: 28px;
              text-transform: uppercase;
            "
          >
            Sertifikat Penghargaan
          </h1>
          <p
            style="
              margin: 15px 0 5px;
              font-style: italic;
              color: #7f8c8d;
              font-size: 18px;
            "
          >
            Dengan bangga diberikan kepada:
          </p>
          <h2
            id="certName"
            style="
              font-size: 38px;
              color: #2980b9;
              margin: 10px 0;
              border-bottom: 3px double #eee;
              display: inline-block;
              padding: 0 30px;
            "
          >
            NAMA PEMAIN
          </h2>
          <p style="margin: 20px 0 10px; font-size: 16px; color: #34495e">
            Atas keberhasilan menyelesaikan seluruh tantangan dengan gelar
            kehormatan:
          </p>
          <h3
            id="certTitle"
            style="
              font-size: 24px;
              color: #27ae60;
              background: #f9f9f9;
              padding: 12px;
              border-radius: 50px;
              display: inline-block;
              min-width: 300px;
              border: 1px solid #27ae60;
            "
          >
            GELAR PEMAIN
          </h3>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 15px;
              margin-top: 30px;
              text-align: left;
              background: #fffcf0;
              padding: 20px;
              border: 1px solid #f1c40f;
              border-radius: 12px;
            "
          >
            <div style="font-size: 15px">
              ‚úÖ Jawaban Benar: <strong id="statCorrect">0</strong>
            </div>
            <div style="font-size: 15px">
              üî• Streak Tertinggi: <strong id="statStreak">0</strong>
            </div>
            <div style="font-size: 15px">
              üö© Tangga Dilewati: <strong id="statLadders">0</strong>
            </div>
            <div style="font-size: 15px">
              üêç Ular Dihadapi: <strong id="statSnakes">0</strong>
            </div>
          </div>

          <p style="margin-top: 20px; font-size: 12px; color: #bdc3c7">
            Diterbitkan oleh Developer Ular Tangga Matematika.
          </p>
        </div>

        <div
          style="
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            padding-bottom: 20px;
          "
        >
          <button
            class="startBtn"
            onclick="downloadCertificate()"
            style="background: #27ae60"
          >
            Unduh PNG
          </button>
          <button class="startBtn" onclick="window.location.reload()">
            Main Lagi
          </button>
        </div>
      </div>
    </div>

    <div class="modal hide" id="infoModal">
      <div class="modalBody" style="max-width: 600px; text-align: left">
        <h1 style="text-align: center; margin-bottom: 25px; color: #2c3e50">
          Informasi Kotak
        </h1>

        <div class="info-item">
          <div class="info-color tile-easy"></div>
          <div class="info-text">
            <span class="info-title">Kotak Hijau (Mudah)</span>
            <p>
              Berisi soal kategori mudah. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-standard"></div>
          <div class="info-text">
            <span class="info-title">Kotak Kuning (Standar)</span>
            <p>
              Berisi soal kategori standar. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-hard"></div>
          <div class="info-text">
            <span class="info-title">Kotak Merah (Sulit)</span>
            <p>
              Berisi soal kategori sulit. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-mystery"></div>
          <div class="info-text">
            <span class="info-title">Kotak Ungu (Misteri)</span>
            <p>Berisi soal analisis/tantangan khusus.</p>
            <div class="info-reward">
              <span class="correct-text">‚úì Benar: Maju 3 langkah</span>
              <span class="wrong-text">‚úó Salah: Mundur 1 langkah</span>
            </div>
          </div>
        </div>

        <div class="info-item storm-info-item">
          <div class="info-color storm-icon-bg">
            <i class="fas fa-bolt" style="color: #f1c40f"></i>
          </div>
          <div class="info-text">
            <span class="info-title">Probability Storm (Event)</span>
            <p>
              Muncul secara berkala. Semua pemain akan diberikan satu soal yang
              sama untuk dijawab secara bergantian.
            </p>
            <div class="info-reward">
              <span class="correct-text"
                >‚úì Benar: Badai berhenti & Maju 3 langkah!</span
              >
              <span class="wrong-text"
                >‚úó Salah: Giliran dilempar ke pemain berikutnya.</span
              >
            </div>
          </div>
        </div>

        <button
          class="startBtn"
          onclick="closeInfoModal()"
          style="width: 100%; margin-top: 20px"
        >
          Mengerti
        </button>
      </div>
    </div>

    <!-- Modal untuk pertanyaan -->
    <div class="modal hide" id="questionModal">
      <div class="modalBody" style="max-width: 600px">
        <div class="question-header">
          <div class="difficulty-badge" id="difficultyBadge">Easy</div>
          <div class="timer" id="timer">30</div>
        </div>

        <div class="question-content">
          <h2 id="questionText">Pertanyaan akan muncul di sini</h2>

          <!-- Multiple Choice -->
          <div id="mcOptions" class="options-container" style="display: none">
            <div class="option">
              <span class="option-letter">A</span>
              <span id="option0">Option 1</span>
            </div>
            <div class="option">
              <span class="option-letter">B</span>
              <span id="option1">Option 2</span>
            </div>
            <div class="option">
              <span class="option-letter">C</span>
              <span id="option2">Option 3</span>
            </div>
          </div>

          <!-- True/False -->
          <div id="tfOptions" class="options-container" style="display: none">
            <div class="option">
              <span class="option-letter">‚úì</span>
              <span>Benar</span>
            </div>
            <div class="option">
              <span class="option-letter">‚úó</span>
              <span>Salah</span>
            </div>
          </div>

          <div id="essayInput" style="display: none">
            <p
              id="essayInstruction"
              style="margin-bottom: 10px; font-weight: bold"
            >
              Tuliskan jawaban Anda:
            </p>

            <div
              class="input-wrapper"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
              "
            >
              <span
                id="leftBrace"
                style="
                  display: none;
                  font-size: 2.5rem;
                  color: #3498db;
                  font-family: 'Courier New', Courier, monospace;
                "
                >{</span
              >

              <math-field
                id="mathAnswerField"
                virtual-keyboard-mode="onfocus"
                virtual-keyboard-policy="manual"
                style="
                  display: none;
                  width: 100%;
                  padding: 8px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  background: white;
                "
              ></math-field>

              <textarea
                id="textAnswerField"
                rows="3"
                style="
                  display: none;
                  width: 100%;
                  padding: 10px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  font-family: sans-serif;
                "
                placeholder="Ketik penjelasan di sini..."
              ></textarea>

              <span
                id="rightBrace"
                style="
                  display: none;
                  font-size: 2.5rem;
                  color: #3498db;
                  font-family: 'Courier New', Courier, monospace;
                "
                >}</span
              >
            </div>

            <button class="submit-btn" style="width: 100%">
              Kirim Jawaban
            </button>
          </div>

          <div id="whatIfInput" style="display: none">
            <p
              id="whatIfInstruction"
              style="margin-bottom: 10px; font-weight: bold"
            >
              Analisis situasi ini:
            </p>

            <div
              class="input-wrapper"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
              "
            >
              <math-field
                id="whatIfMathField"
                virtual-keyboard-mode="onfocus"
                style="
                  display: none;
                  width: 100%;
                  padding: 8px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  background: white;
                "
              ></math-field>

              <textarea
                id="whatIfAnswer"
                rows="3"
                style="
                  display: none;
                  width: 100%;
                  padding: 10px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  font-family: sans-serif;
                "
                placeholder="Ketik jawaban analisis Anda di sini..."
              ></textarea>
            </div>

            <button class="submit-btn" style="width: 100%">Submit</button>
          </div>
        </div>

        <div
          id="explanation"
          style="
            display: none;
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
          "
        >
          <strong>Penjelasan:</strong> <span id="explanationText"></span>
        </div>

        <!-- <div class="question-footer">
          <button
            class="startBtn"
            onclick="closeQuestionModal()"
            style="background: #666"
          >
            Tutup
          </button>
        </div> -->
      </div>
    </div>

    <!-- Modal untuk hasil jawaban -->
    <div class="modal hide" id="resultModal">
      <div class="modalBody" style="max-width: 500px">
        <div id="resultIcon" style="font-size: 60px; margin-bottom: 20px">
          ‚úì
        </div>
        <h1 id="resultTitle">Jawaban Benar!</h1>
        <p id="resultMessage">Anda akan maju sesuai dadu!</p>
        <button class="startBtn" onclick="closeResultModal()">Lanjut</button>
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      // Konfigurasi MathLive agar keyboard bisa berinteraksi di dalam modal
      if (window.mathVirtualKeyboard) {
        window.mathVirtualKeyboard.container = document.body;
      }

      // Tambahkan event listener global untuk memastikan math-field siap
      document.addEventListener("focusin", (e) => {
        if (e.target.tagName === "MATH-FIELD") {
          // Mencegah modal "mencuri" fokus kembali
          e.stopPropagation();
        }
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </body>
</html>
