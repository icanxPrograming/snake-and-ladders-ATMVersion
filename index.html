<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Snakes and Ladders Game</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Icon -->
    <link rel="icon" type="image/x-icon" href="images/icon.png" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <script
      defer
      src="https://unpkg.com/mathlive@0.98.5/dist/mathlive.min.js"
    ></script>
    <style>
      /* MathLive Keyboard Z-Index Fix */
      :root {
        --keyboard-zindex: 20000; /* Angka sangat besar agar di atas modal */
      }

      /* Pastikan elemen keyboard bisa menerima klik */
      div.ML__keyboard,
      .ML__virtual-keyboard-container {
        pointer-events: all !important;
        z-index: 20000 !important;
      }

      /* Hilangkan hambatan pointer pada math-field */
      math-field {
        pointer-events: all !important;
        touch-action: manipulation;
      }

      /* Warna saat dipilih */
      #diff-easy.selected {
        background-color: #2ecc71 !important;
        color: white;
        border-color: #27ae60;
      }

      #diff-standard.selected {
        background-color: #f1c40f !important;
        color: white;
        border-color: #f39c12;
      }

      #diff-hard.selected {
        background-color: #e67e22 !important;
        color: white;
        border-color: #d35400;
      }

      .difficultyBox:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .tile-easy {
        background-color: rgba(46, 204, 113, 0.4) !important;
      } /* Hijau */
      .tile-standard {
        background-color: rgba(241, 196, 15, 0.4) !important;
      } /* Kuning */
      .tile-hard {
        background-color: rgba(231, 76, 60, 0.4) !important;
      } /* Merah */
      .tile-mystery {
        background-color: rgba(155, 89, 182, 0.4) !important;
      } /* Ungu */
    </style>
  </head>
  <body>
    <div class="screen" id="screen1">
      <!-- Add a resume button so game can be played again -->
      <!-- Initial Stage for selection players count -->
      <div class="s1-card">
        <h1>Math Snakes and Ladder Game</h1>
        <p class="subHeading">Rise Above the Snakes, Aim for the Ladders!</p>
        <div class="choose">
          <div class="selectBox selected" onclick="selectPlayers(2)">
            <span>2</span> <span>Players</span>
          </div>
          <div class="selectBox" onclick="selectPlayers(3)">
            <span>3</span> <span>Players</span>
          </div>
          <div class="selectBox" onclick="selectPlayers(4)">
            <span>4</span> <span>Players</span>
          </div>
        </div>
        <button class="startBtn" onclick="start()">START</button>
      </div>
    </div>
    <div class="screen" id="screen2">
      <div class="s1-card">
        <h1>Profile & Tingkat Kesulitan</h1>

        <div class="cards">
          <div class="card" id="card1">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(1,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/1.png" id="profile1" />
              </div>
              <div class="arrow" onclick="updateUserProfile(1,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(1)"
                onblur="updateValue(1)"
                type="text"
                placeholder="Nami..."
                value="Player1"
                id="name1"
              />
            </div>
          </div>

          <div class="card" id="card2">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(2,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/0.png" id="profile2" />
              </div>
              <div class="arrow" onclick="updateUserProfile(2,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(2)"
                onblur="updateValue(2)"
                type="text"
                placeholder="Nami..."
                value="Player2"
                id="name2"
              />
            </div>
          </div>

          <div class="card" id="card3">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(3,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/3.png" id="profile3" />
              </div>
              <div class="arrow" onclick="updateUserProfile(3,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(3)"
                onblur="updateValue(3)"
                type="text"
                placeholder="Nami..."
                value="Player3"
                id="name3"
              />
            </div>
          </div>

          <div class="card" id="card4">
            <div class="profile">
              <div class="arrow" onclick="updateUserProfile(4,2)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_left</span
                >
              </div>
              <div class="selectImage">
                <img src="images/avatars/4.png" id="profile4" />
              </div>
              <div class="arrow" onclick="updateUserProfile(4,1)">
                <span class="material-symbols-outlined"
                  >keyboard_arrow_right</span
                >
              </div>
            </div>
            <div class="inputName">
              <input
                onclick="this.select()"
                oninput="changeName(4)"
                onblur="updateValue(4)"
                type="text"
                placeholder="Nami..."
                value="Player4"
                id="name4"
              />
            </div>
          </div>
        </div>

        <hr style="width: 80%; margin: 20px auto; opacity: 0.3" />

        <div class="difficulty-selection">
          <h3 style="margin-bottom: 15px; font-family: sans-serif">
            Pilih Tingkat Kesulitan Game:
          </h3>
          <div class="choose" style="justify-content: center; gap: 15px">
            <div
              class="selectBox difficultyBox"
              id="diff-easy"
              onclick="setGameDifficulty('easy')"
            >
              <span>Mudah</span>
            </div>

            <div
              class="selectBox difficultyBox selected"
              id="diff-standard"
              onclick="setGameDifficulty('standard')"
            >
              <span>Standar</span>
            </div>

            <div
              class="selectBox difficultyBox"
              id="diff-hard"
              onclick="setGameDifficulty('hard')"
            >
              <span>Sulit</span>
            </div>
          </div>
        </div>

        <div style="margin-top: 30px">
          <button class="startBtn" onclick="back()">Kembali</button>
          <button class="startBtn next" onclick="next()">MULAI GAME</button>
        </div>
      </div>
    </div>
    <div class="screen" id="screen3">
      <!-- Game board player status and many more -->
      <div class="container">
        <button class="info-btn" onclick="openInfoModal()">
          <span class="material-symbols-outlined">info</span>
        </button>
        <div class="boardArea">
          <div class="bigBoard">
            <img src="images/board.jpeg" class="board" />
            <div class="potsBoard" id="board"></div>
          </div>
        </div>
        <div class="gamePlayers">
          <div class="playersBox">
            <div class="playerCard" id="playerCard1">
              <div class="level1">
                <img src="images/avatars/1.png" id="avatar1" />
                <div id="dice1" class="diceBox" onclick="rollDice(1)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName1">Player1</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard2">
              <div class="level1">
                <img src="images/avatars/2.png" id="avatar2" />
                <div id="dice2" class="diceBox" onclick="rollDice(2)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName2">Player2</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard4">
              <div class="level1">
                <img src="images/avatars/4.png" id="avatar4" />
                <div id="dice4" class="diceBox" onclick="rollDice(4)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName4">Player4</div>
              </div>
            </div>
            <div class="playerCard" id="playerCard3">
              <div class="level1">
                <img src="images/avatars/3.png" id="avatar3" />
                <div id="dice3" class="diceBox" onclick="rollDice(3)">
                  <i class="diceImg fas fa-dice-one"></i>
                </div>
              </div>
              <div class="level2">
                <div id="displayName3">Player3</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal hide" id="modal">
      <div class="modalBody">
        <img src="images/avatars/0.png" id="wimg" />
        <h1>Winner is <span id="wname"></span></h1>
        <button class="startBtn" onclick="window.location.reload()">
          New Game
        </button>
      </div>
    </div>
    <audio src="audio/drop.mp3" id="drop" style="display: none"></audio>
    <audio src="audio/ladder.mp3" id="ladder" style="display: none"></audio>
    <audio src="audio/snake.mp3" id="snake" style="display: none"></audio>
    <audio src="audio/dice.mp3" id="diceAudio" style="display: none"></audio>
    <audio src="audio/success.mp3" id="success" style="display: none"></audio>

    <div class="modal hide" id="infoModal">
      <div class="modalBody" style="max-width: 600px; text-align: left">
        <h1 style="text-align: center; margin-bottom: 25px; color: #2c3e50">
          Informasi Kotak
        </h1>

        <div class="info-item">
          <div class="info-color tile-easy"></div>
          <div class="info-text">
            <span class="info-title">Kotak Hijau (Mudah)</span>
            <p>
              Berisi soal kategori mudah. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-standard"></div>
          <div class="info-text">
            <span class="info-title">Kotak Kuning (Standar)</span>
            <p>
              Berisi soal kategori standar. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-hard"></div>
          <div class="info-text">
            <span class="info-title">Kotak Merah (Sulit)</span>
            <p>
              Berisi soal kategori sulit. Jika benar, maju 1 langkah. Jika
              salah, tetap di tempat.
            </p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-color tile-mystery"></div>
          <div class="info-text">
            <span class="info-title">Kotak Ungu (Misteri)</span>
            <p>Berisi soal analisis/tantangan khusus.</p>
            <div class="info-reward">
              <span class="correct-text">✓ Benar: Maju 3 langkah</span>
              <span class="wrong-text">✗ Salah: Mundur 1 langkah</span>
            </div>
          </div>
        </div>

        <button
          class="startBtn"
          onclick="closeInfoModal()"
          style="width: 100%; margin-top: 20px"
        >
          Mengerti
        </button>
      </div>
    </div>

    <!-- Modal untuk pertanyaan -->
    <div class="modal hide" id="questionModal">
      <div class="modalBody" style="max-width: 600px">
        <div class="question-header">
          <div class="difficulty-badge" id="difficultyBadge">Easy</div>
          <div class="timer" id="timer">30</div>
        </div>

        <div class="question-content">
          <h2 id="questionText">Pertanyaan akan muncul di sini</h2>

          <!-- Multiple Choice -->
          <div id="mcOptions" class="options-container" style="display: none">
            <div class="option">
              <span class="option-letter">A</span>
              <span id="option0">Option 1</span>
            </div>
            <div class="option">
              <span class="option-letter">B</span>
              <span id="option1">Option 2</span>
            </div>
            <div class="option">
              <span class="option-letter">C</span>
              <span id="option2">Option 3</span>
            </div>
          </div>

          <!-- True/False -->
          <div id="tfOptions" class="options-container" style="display: none">
            <div class="option">
              <span class="option-letter">✓</span>
              <span>Benar</span>
            </div>
            <div class="option">
              <span class="option-letter">✗</span>
              <span>Salah</span>
            </div>
          </div>

          <div id="essayInput" style="display: none">
            <p
              id="essayInstruction"
              style="margin-bottom: 10px; font-weight: bold"
            >
              Tuliskan jawaban Anda:
            </p>

            <div
              class="input-wrapper"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
              "
            >
              <span
                id="leftBrace"
                style="
                  display: none;
                  font-size: 2.5rem;
                  color: #3498db;
                  font-family: 'Courier New', Courier, monospace;
                "
                >{</span
              >

              <math-field
                id="mathAnswerField"
                virtual-keyboard-mode="onfocus"
                virtual-keyboard-policy="manual"
                style="
                  display: none;
                  width: 100%;
                  padding: 8px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  background: white;
                "
              ></math-field>

              <textarea
                id="textAnswerField"
                rows="3"
                style="
                  display: none;
                  width: 100%;
                  padding: 10px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  font-family: sans-serif;
                "
                placeholder="Ketik penjelasan di sini..."
              ></textarea>

              <span
                id="rightBrace"
                style="
                  display: none;
                  font-size: 2.5rem;
                  color: #3498db;
                  font-family: 'Courier New', Courier, monospace;
                "
                >}</span
              >
            </div>

            <button class="submit-btn" style="width: 100%">
              Kirim Jawaban
            </button>
          </div>

          <div id="whatIfInput" style="display: none">
            <p
              id="whatIfInstruction"
              style="margin-bottom: 10px; font-weight: bold"
            >
              Analisis situasi ini:
            </p>

            <div
              class="input-wrapper"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
              "
            >
              <math-field
                id="whatIfMathField"
                virtual-keyboard-mode="onfocus"
                style="
                  display: none;
                  width: 100%;
                  padding: 8px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  background: white;
                "
              ></math-field>

              <textarea
                id="whatIfAnswer"
                rows="3"
                style="
                  display: none;
                  width: 100%;
                  padding: 10px;
                  border-radius: 8px;
                  border: 2px solid #ddd;
                  font-family: sans-serif;
                "
                placeholder="Ketik jawaban analisis Anda di sini..."
              ></textarea>
            </div>

            <button class="submit-btn" style="width: 100%">Submit</button>
          </div>
        </div>

        <div
          id="explanation"
          style="
            display: none;
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
          "
        >
          <strong>Penjelasan:</strong> <span id="explanationText"></span>
        </div>

        <!-- <div class="question-footer">
          <button
            class="startBtn"
            onclick="closeQuestionModal()"
            style="background: #666"
          >
            Tutup
          </button>
        </div> -->
      </div>
    </div>

    <!-- Modal untuk hasil jawaban -->
    <div class="modal hide" id="resultModal">
      <div class="modalBody" style="max-width: 500px">
        <div id="resultIcon" style="font-size: 60px; margin-bottom: 20px">
          ✓
        </div>
        <h1 id="resultTitle">Jawaban Benar!</h1>
        <p id="resultMessage">Anda akan maju sesuai dadu!</p>
        <button class="startBtn" onclick="closeResultModal()">Lanjut</button>
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      // Konfigurasi MathLive agar keyboard bisa berinteraksi di dalam modal
      if (window.mathVirtualKeyboard) {
        window.mathVirtualKeyboard.container = document.body;
      }

      // Tambahkan event listener global untuk memastikan math-field siap
      document.addEventListener("focusin", (e) => {
        if (e.target.tagName === "MATH-FIELD") {
          // Mencegah modal "mencuri" fokus kembali
          e.stopPropagation();
        }
      });
    </script>
  </body>
</html>
